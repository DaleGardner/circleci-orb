description: >
  A single, complete job to run Cypress tests

parameters:
  install-browsers:
    type: boolean
    default: false
    description: Flag to install additional browsers to run your tests. This is only needed if you are passing the `--browser`` flag in your `cypress-command`. This includes Chrome, FireFox, ChromeDriver and GeckoDriver. If you need additional browser support you can set this to false and make sure you use an executor with a docker image that includes the browsers of your choosing see https://hub.docker.com/r/cypress/browsers/tags
  working-directory:
    description: Directory containing package.json
    type: string
    default: ""
  start-command:
    description: Command used to start your local dev server for Cypress to tests against
    type: string
    default: ""
  cypress-command:
    description: Command used to run your Cypress tests
    type: string
    default: "npx cypress run"

steps:
  - when:
      condition: << parameters.install-browsers >>
      steps:
        - browser-tools/install-browser-tools
  - when:
      condition: << parameters.start-command >>
      steps:
        - run:
            name: Start Server
            command: << parameters.start-command >>
            background: true
            working_directory: << parameters.working-directory >>
  - run:
      name: Run Cypress
      command: << parameters.cypress-command >>
      working_directory: << parameters.working-directory >>
  - store_artifacts:
      path: << parameters.working-directory >>/cypress/videos
  - store_artifacts:
      path: << parameters.working-directory >>/cypress/screenshots
